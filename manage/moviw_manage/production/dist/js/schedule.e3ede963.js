(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["schedule"],{"1f80":function(e,t,i){var s=i("d670"),a=i("f964"),r=i("ec5c");a=a.default||a,r=r.default||r,"undefined"!==typeof window&&(window.Swiper=s);var o={swiperSlide:r,swiper:a,swiperPlugins:s.prototype.plugins,install:function(e){e.component(a.name,a),e.component(r.name,r)}};e.exports=o},"20bd":function(e,t,i){"use strict";i("f58e")},"82bc":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{height:"50%"}},[i("el-card",[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),i("el-breadcrumb-item",[e._v("排片管理")]),i("el-breadcrumb-item",[e._v("添加排片")])],1)],1),i("el-card",{staticStyle:{"margin-top":"10px",position:"relative"}},[i("div",{staticClass:"sliderBox"},[i("my-swiper",{attrs:{data:e.movie_info},on:{"index-data":function(t){return e.indexData(t)}}})],1),i("div",{staticClass:"pointer"})]),i("el-tabs",{staticStyle:{"margin-top":"10px","min-height":"400px","text-align":"center","margin-bottom":"20px"},attrs:{type:"border-card"}},[0==e.movie_time.length?i("div",{staticClass:"timeIsNull"},[i("div",{staticStyle:{width:"100%"}},[e._v("暂无时间安排")]),i("el-button",{staticStyle:{"margin-top":"10%"},attrs:{type:"success"},on:{click:e.addTime}},[e._v("添加拍片")])],1):e._e(),e.movie_time.length>0?i("el-card",[i("el-button",{attrs:{type:"success"},on:{click:e.addTime}},[e._v("添加拍片")])],1):e._e(),e._l(e.movie_time,(function(t,s){return i("el-tab-pane",{key:s,staticStyle:{"margin-top":"10px"},attrs:{label:t.m_date}},[i("el-table",{staticStyle:{width:"100%","min-height":"300px"},attrs:{data:t.dateChildren,"default-sort":{prop:"m_start",order:"descending"}}},[i("el-table-column",{attrs:{prop:"period_id",label:"场次id",width:"100"}}),i("el-table-column",{attrs:{prop:"m_date",label:"日期",width:"180"}}),i("el-table-column",{attrs:{prop:"r_name",label:"放映室"}}),i("el-table-column",{attrs:{prop:"m_start",sortable:"custom",label:"开始时间"}}),i("el-table-column",{attrs:{prop:"m_stop",label:"结束时间"}}),i("el-table-column",{attrs:{prop:"tag",label:"是否可购买",width:"100","filter-placement":"bottom-end"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tag",{attrs:{type:"0"===t.row.is_buy?"danger":"success","disable-transitions":""}},[e._v("\n              "+e._s("1"==t.row.is_buy?"是":"否"))])]}}],null,!0)}),i("el-table-column",{attrs:{prop:"price",label:"本场价格"}}),i("el-table-column",{attrs:{label:"编辑",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[i("el-popconfirm",{attrs:{title:"这是一段内容确定删除吗？"},on:{confirm:function(i){return e.delAlreadyAddTime(t.row)}}},[i("el-button",{attrs:{slot:"reference",size:"small",type:"danger"},on:{click:function(t){e.visible=!0}},slot:"reference"},[e._v("删除")])],1)],1)]}}],null,!0)})],1)],1)}))],2),i("div",{staticStyle:{width:"100%",height:"10px"}}),i("el-dialog",{attrs:{title:"设置开始时间",visible:e.addTimeVisibel,width:"90%","before-close":e.addTimehandleClose,center:""},on:{"update:visible":function(t){e.addTimeVisibel=t}}},[i("el-form",{ref:"addTimeTemFormRef",staticClass:"demo-ruleForm",attrs:{model:e.addTimeForm,rules:e.rules,"label-width":"100px"}},[i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"日期",prop:"m_date"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{align:"right",type:"date",placeholder:"选择日期","picker-options":e.pickerOptions},model:{value:e.addTimeForm.m_date,callback:function(t){e.$set(e.addTimeForm,"m_date",t)},expression:"addTimeForm.m_date"}})],1)],1),i("el-col",{attrs:{span:12}})],1),i("el-row"),i("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.dateIsNull,expression:"dateIsNull"}],staticStyle:{"margin-bottom":"10px"},attrs:{title:"请先选择日期",type:"warning",closable:!1}}),e._l(e.addTimeForm.timesCount,(function(t,s){return i("el-row",{key:s},[i("el-col",{attrs:{span:5}},[i("el-form-item",{attrs:{label:"开始时间",prop:"timesCount."+s+".start",rules:e.rules.start}},[i("el-time-select",{staticStyle:{width:"auto"},attrs:{disabled:e.dateIsNull,format:"HH-mm","picker-options":{start:"08:00",step:"00:05",end:"23:30"},placeholder:"添加时间"},on:{change:function(i){return e.selectTime(t.start,s)}},model:{value:t.start,callback:function(i){e.$set(t,"start",i)},expression:"item.start"}})],1)],1),i("el-col",{attrs:{span:5}},[i("el-form-item",{attrs:{label:"结束时间"}},[i("el-input",{attrs:{placeholder:"选择开始时间自动生成结束时间",disabled:!0},model:{value:t.stop,callback:function(i){e.$set(t,"stop",i)},expression:"item.stop"}})],1)],1),i("el-col",{attrs:{span:4}},[i("el-form-item",{attrs:{label:"票价",prop:"timesCount."+s+".price",rules:e.rules.price}},[i("el-input",{attrs:{placeholder:"本场价格"},model:{value:t.price,callback:function(i){e.$set(t,"price",i)},expression:"item.price"}})],1)],1),i("el-col",{attrs:{span:5}},[i("el-form-item",{attrs:{label:"选择影厅",prop:"timesCount."+s+".m_rid",rules:e.rules.m_rid}},[i("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入内容"},on:{select:function(t){return e.roomSelectd(t,s)}},model:{value:t.temRoomName,callback:function(i){e.$set(t,"temRoomName",i)},expression:"item.temRoomName"}})],1)],1),i("el-col",{attrs:{span:5}},[i("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"danger"},on:{click:function(t){return e.delTime(s)}}},[i("i",{staticClass:"iconfont el-icon-shanchu"})])],1),i("el-divider")],1)})),i("div",{staticStyle:{"text-align":"center"}},[i("el-button",{attrs:{type:"success"},on:{click:function(t){return e.addTimeArr()}}},[e._v("添加时间")])],1)],2),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){return e.addTimeCancel("addTimeTemFormRef")}}},[e._v("取 消")]),i("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.addLoading,expression:"addLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"element-loading-text":e.loadText,type:"primary"},on:{click:function(t){return e.addTimeFinish("addTimeTemFormRef")}}},[e._v("确 定")])],1)],1)],1)},a=[],r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"swiper-container"},[i("swiper",{ref:"mySwiper",attrs:{options:e.swiperOptions}},[e._l(e.data,(function(e,t){return i("swiper-slide",{key:e.movie_id,staticStyle:{"touch-action":"none"}},[i("div",{staticClass:"imgDiv",style:"background-image:url("+e.main_pic+")"})])})),i("div",{staticClass:"swiper-pagination",attrs:{slot:"pagination"},slot:"pagination"})],2),i("div",{staticClass:"swiper-button-prev",attrs:{slot:"button-prev"},slot:"button-prev"}),i("div",{staticClass:"swiper-button-next",attrs:{slot:"button-next"},slot:"button-next"})],1)},o=[],n=i("1f80");i("dfa4");let l=null;var d={name:"HomeSwiper",props:{data:{type:Array,required:!0}},components:{swiper:n["swiper"],swiperSlide:n["swiperSlide"]},data(){return{swiperOptions:{width:1200,notNextTick:!0,centeredSlides:!0,observer:!0,initialSlide:0,touchRatio:.8,effect:"",slidesPerView:7,paginationClickable:!0,slideToClickedSlide:!0,prevButton:".swiper-button-prev",nextButton:".swiper-button-next",onTransitionEnd:function(e){l.$emit("index-data",l.data[e.activeIndex].movie_id)}}}},methods:{},beforeUpdate(){l.$emit("index-data",this.data[0].movie_id)},created(){l=this}},m=d,c=(i("d31d"),i("2877")),p=Object(c["a"])(m,r,o,!1,null,null,null),u=p.exports,h={components:{mySwiper:u},data(){var e=(e,t,i)=>{var s=/(^[1-9]\d*(\.\d{1,2})?$)|(^0(\.\d{1,2})?$)/;s.test(t)?t<1?this.$notify({title:"警告",message:"请输入价格",type:"warning"}):i():i(new Error("请输入正确格式,最多两位小数"))},t=(e,t,i)=>{for(let s=0;s<this.addTimeForm.timesCount.length;s++)for(let e=0;e<s;e++)this.addTimeForm.timesCount[s].start==this.addTimeForm.timesCount[e].start&&i(new Error("重复"));t<1?i(new Error("请输入开始时间")):i()};return{movieIndex:"",movie_info:[],movie_time:[],movie_img:{},addTimeVisibel:!1,visible:!1,addTimeForm:{m_date:"",m_id:"",timesCount:[{start:"",stop:"",m_rid:"",temRoomName:"",price:this.getPrice}],is_buy:1},addLoading:!1,loadText:"添加中...",pickerOptions:{disabledDate(e){return e.getTime()+864e5<new Date},shortcuts:[{text:"今天",onClick(e){e.$emit("pick",new Date)}},{text:"明天",onClick(e){const t=new Date;t.setTime(t.getTime()+864e5),e.$emit("pick",t)}},{text:"后天",onClick(e){const t=new Date;t.setTime(t.getTime()+1728e5),e.$emit("pick",t)}},{text:`${(new Date).getMonth()+1}月${(new Date).getDate()+3}日`,onClick(e){const t=new Date;t.setTime(t.getTime()+2592e5),e.$emit("pick",t)}},{text:`${(new Date).getMonth()+1}月${(new Date).getDate()+4}日`,onClick(e){const t=new Date;t.setTime(t.getTime()+3456e5),e.$emit("pick",t)}},{text:`${(new Date).getMonth()+1}月${(new Date).getDate()+5}日`,onClick(e){const t=new Date;t.setTime(t.getTime()+432e6),e.$emit("pick",t)}}]},rules:{m_date:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],start:[{validator:t,trigger:"change"}],m_rid:[{type:"number",required:!0,message:"请选择影厅",trigger:"change"}],price:[{validator:e,trigger:"change"}]}}},methods:{async getMovieInfo(){let{data:e}=await this.$axios.get("/getInfo");if(200!=e.meta.status)return this.$message.error("获取电影信息失败");this.$message.success("获取成功"),this.movie_info=e.data},indexData(e){this.movieIndex=e,console.log(e)},async getMovieTime(){let{data:e}=await this.$axios.get("/getinfo/time",{params:{movie_id:this.movieIndex}});if(200!==e.meta.status)return this.$message.error("获取失败");this.movie_time=e.data,console.log(e.data)},addTime(){this.addTimeForm.timesCount[0].price=this.getPrice,this.addTimeForm.m_id=this.movieIndex,this.addTimeVisibel=!0},addTimehandleClose(e){this.$confirm("确认关闭？").then(t=>{e()}).catch(e=>{})},addTimeFinish(e){this.$refs[e].validate(async t=>{if(!t)return this.$notify.error("请输入关键信息");{this.addLoading=!0;let t=0,i=["添加中......","创建时间中......","创建座位影厅中......","即将完成......"],s=this,a=setInterval((function(){s.loadText=i[t],t++,4==t&&clearInterval(a)}),parseInt(1e3*Math.random())+1);console.log(this.addTimeForm);let{data:r}=await this.$axios.post("/addinfo/addTime",this.addTimeForm);if(200!=r.meta.status)return this.addLoading=!1,this.$message.error(r.meta.msg);this.$message.success("添加成功"),this.addTimeVisibel=!1,this.$refs[e].resetFields(),this.getMovieTime(),this.addTimeForm.timesCount=[{start:"",stop:"",m_rid:"",temRoomName:"",price:this.getPrice}],this.addLoading=!1}})},addTimeCancel(e){this.addTimeVisibel=!1,this.$refs[e].resetFields()},time(e,t,i){let s=60*e*1e3,a=new Date(t+" "+i).getTime(),r=new Date(t+" "+i).getTime()+s,o={start:"",stop:""};for(let n=0;n<1;n++){if(new Date(a+s*n).getDay()>new Date(a).getDay())break;o.start=new Date(a+s*n),o.stop=new Date(r+s*n)}return o},formateHM(e){let t=e.getHours(),i=e.getMinutes();return"00"==t&&(t="24"),!(t>="10")&&(t="0"+t),!(i>="10")&&(i="0"+i),`${t}:${i}`},addTimeArr(){this.addTimeForm.timesCount.push({start:this.addTimeForm.timesCount[this.addTimeForm.timesCount.length-1].start,stop:"",price:this.getPrice})},selectTime(e,t){let i=`${this.addTimeForm.m_date.getFullYear()}-${this.addTimeForm.m_date.getMonth()+1}-${this.addTimeForm.m_date.getDate()}`,s=this.time(this.getTimeLength,i,e);this.formateHM(s.stop);if(""==this.addTimeForm.timesCount[t].start||null==this.addTimeForm.timesCount[t].start)return this.addTimeForm.timesCount[t].stop="无";this.addTimeForm.timesCount[t].stop=this.formateHM(s.stop)},delTime(e){this.addTimeForm.timesCount.splice(e,1)},async querySearchAsync(e,t){console.log("搜索触发");let{data:i}=await this.$axios.get("room/all");if(200!==i.meta.status)return this.$message.error("查询错误");let s=[];i.data.forEach((e,t)=>{s.push({value:e.r_name,id:e.r_id})}),t(s)},roomSelectd(e,t){this.addTimeForm.timesCount[t].m_rid=e.id},async delAlreadyAddTime(e){let{data:t}=await this.$axios.delete("/updateinfo/deltime",{data:e});if(200!=t.meta.status)return this.$message.error(t.meta.msg);this.$message.success(t.meta.msg),this.getMovieTime()}},watch:{movieIndex(){this.getMovieTime()}},created(){console.log("created"),this.getMovieInfo()},mounted(){},computed:{getTimeLength(){let e="";return this.movie_info.forEach((t,i)=>{t.movie_id==this.movieIndex&&(e=t.time_length)}),e},getPrice(){let e="";return this.movie_info.forEach((t,i)=>{t.movie_id==this.movieIndex&&(e=t.movie_price)}),e},dateIsNull(){return""==this.addTimeForm.m_date||null==this.addTimeForm.m_date}}},f=h,g=(i("20bd"),Object(c["a"])(f,s,a,!1,null,null,null));t["default"]=g.exports},b669:function(e,t,i){},d31d:function(e,t,i){"use strict";i("b669")},dfa4:function(e,t,i){},ec5c:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.slideClass},[e._t("default")],2)},a=[],r={name:"swiper-slide",data:function(){return{slideClass:"swiper-slide"}},ready:function(){this.update()},mounted:function(){this.update(),this.$parent.options.slideClass&&(this.slideClass=this.$parent.options.slideClass)},updated:function(){this.update()},attached:function(){this.update()},methods:{update:function(){this.$parent&&this.$parent.swiper&&this.$parent.swiper.update&&(this.$parent.swiper.update(!0),this.$parent.options.loop&&this.$parent.swiper.reLoop())}}},o=r,n=i("2877"),l=Object(n["a"])(o,s,a,!1,null,null,null);t["default"]=l.exports},f58e:function(e,t,i){},f964:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"swiper-container"},[e._t("parallax-bg"),i("div",{class:e.defaultSwiperClasses.wrapperClass},[e._t("default")],2),e._t("pagination"),e._t("button-prev"),e._t("button-next"),e._t("scrollbar")],2)},a=[],r="undefined"!==typeof window;r&&(window.Swiper=i("d670"));var o={name:"swiper",props:{options:{type:Object,default:function(){return{autoplay:3500}}},notNextTick:{type:Boolean,default:function(){return!1}}},data:function(){return{defaultSwiperClasses:{wrapperClass:"swiper-wrapper"}}},ready:function(){!this.swiper&&r&&(this.swiper=new Swiper(this.$el,this.options))},mounted:function(){var e=this,t=function(){if(!e.swiper&&r){delete e.options.notNextTick;var t=!1;for(var i in e.defaultSwiperClasses)e.defaultSwiperClasses.hasOwnProperty(i)&&e.options[i]&&(t=!0,e.defaultSwiperClasses[i]=e.options[i]);var s=function(){e.swiper=new Swiper(e.$el,e.options)};t?e.$nextTick(s):s()}}(this.options.notNextTick||this.notNextTick)?t():this.$nextTick(t)},updated:function(){this.swiper&&this.swiper.update()},beforeDestroy:function(){this.swiper&&(this.swiper.destroy(),delete this.swiper)}},n=o,l=i("2877"),d=Object(l["a"])(n,s,a,!1,null,null,null);t["default"]=d.exports}}]);
//# sourceMappingURL=schedule.e3ede963.js.map